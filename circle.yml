machine:
  ruby:
    version: 2.4.1
  post:
    - |
      if [[ -e ~/rvm_binaries/ruby-2.1.10.tar.bz2 ]]
      then
        rvm mount ~/rvm_binaries/ruby-2.1.10.tar.bz2
      else
        mkdir -p ~/rvm_binaries
        rvm install 2.1.10
        cd ~/rvm_binaries && rvm prepare 2.1.10
      fi
    - |
      if [[ -e ~/rvm_binaries/ruby-2.2.6.tar.bz2 ]]
      then
        rvm mount ~/rvm_binaries/ruby-2.2.6.tar.bz2
      else
        mkdir -p ~/rvm_binaries
        rvm install 2.2.6
        cd ~/rvm_binaries && rvm prepare 2.2.6
      fi
    - |
      if [[ -e ~/rvm_binaries/ruby-2.3.3.tar.bz2 ]]
      then
        rvm mount ~/rvm_binaries/ruby-2.3.3.tar.bz2
      else
        mkdir -p ~/rvm_binaries
        rvm install 2.3.3
        cd ~/rvm_binaries && rvm prepare 2.3.3
      fi
    - |
      if [[ -e ~/rvm_binaries/ruby-2.4.1.tar.bz2 ]]
      then
        rvm mount ~/rvm_binaries/ruby-2.4.1.tar.bz2
      else
        mkdir -p ~/rvm_binaries
        rvm install 2.4.1
        cd ~/rvm_binaries && rvm prepare 2.4.1
      fi
    - rvm --default use 2.4.1

dependencies:
  bundler:
    without: [test]
  cache_directories:
    - ~/rvm_binaries
    - vendor/bundle

  override:
    - rvm-exec 2.1.10 bash -c "bundle check --path=vendor/bundle || bundle install --path=vendor/bundle"
    - rvm-exec 2.2.6 bash -c "bundle check --path=vendor/bundle || bundle install --path=vendor/bundle"
    - rvm-exec 2.3.3 bash -c "bundle check --path=vendor/bundle || bundle install --path=vendor/bundle"
    - rvm-exec 2.4.1 bash -c "bundle check --path=vendor/bundle || bundle install --path=vendor/bundle"

test:
  override:
    - rvm-exec 2.1.10 bash -c "bundle exec rake"
    - rvm-exec 2.2.6 bash -c "bundle exec rake"
    - rvm-exec 2.3.3 bash -c "bundle exec rake"
    - rvm-exec 2.4.1 bash -c "bundle exec rake"
